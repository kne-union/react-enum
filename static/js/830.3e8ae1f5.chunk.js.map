{"version":3,"file":"static/js/830.3e8ae1f5.chunk.js","mappings":"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","sources":["../../src/preset.js","../../src/index.js"],"sourcesContent":["import { LRUCache } from 'lru-cache';\nimport merge from 'lodash/merge';\n\nexport const globalParams = {\n  base: {},\n  cache: {\n    max: 100\n  }\n};\n\nlet cache = new LRUCache(globalParams.cache);\n\nconst preset = options => {\n  merge(globalParams, options);\n  cache = new LRUCache(globalParams.cache);\n};\n\nexport const getCache = () => {\n  return cache;\n};\n\nexport default preset;\n","import React from 'react';\nimport { useGlobalContext, usePreset } from '@kne/global-context';\nimport useRefCallback from '@kne/use-ref-callback';\nimport Fetch, { useFetch } from '@kne/react-fetch';\nimport groupBy from 'lodash/groupBy';\nimport uniq from 'lodash/uniq';\nimport transform from 'lodash/transform';\nimport preset, { globalParams, getCache } from './preset';\nimport { isEmpty } from '@kne/is-empty';\n\nconst formatEnum = ({ value, format, language, locale }) => {\n  if (!value) {\n    return '';\n  }\n  const label = value.translation?.[language || locale] || value.description;\n  if (format === 'origin') {\n    return value;\n  }\n  if (format === 'option') {\n    return Object.assign({}, value, { label });\n  }\n  return label;\n};\n\nconst useEnumResource = () => {\n  const { enums } = usePreset();\n  return useRefCallback(async ({ moduleNames, language }) => {\n    const getResource = async target => {\n      const loader = Object.assign({}, globalParams.base, enums)[target];\n      if (!loader) {\n        console.warn(`枚举[${target}]的loader没有被正确设置`);\n        return null;\n      }\n\n      //locale参数可能被废弃\n      const resource = await (typeof loader === 'function' ? loader({ target, language, locale: language }) : loader);\n\n      if (Array.isArray(resource)) {\n        return new Map(resource.map(item => [String(item.value), item]));\n      }\n      if (resource instanceof Map) {\n        return resource;\n      }\n      throw new Error('获取到的resource类型不正确，仅支持Array或Map');\n    };\n    return await Promise.all(moduleNames.map(getResource));\n  });\n};\n\nconst useEnumLoader = () => {\n  const resource = useEnumResource();\n  return useRefCallback(async ({ requests, format, language, placeholder }) => {\n    const cache = getCache();\n    const getCacheKey = request => {\n      return Symbol.for(`${request.moduleName}_${request.value}_${language}_${request.format || format}`);\n    };\n    const requestsGroup = groupBy(requests, request => {\n      return !request.force && cache.has(getCacheKey(request)) ? 'cached' : 'uncached';\n    });\n\n    const uncached = requestsGroup.uncached || [],\n      cached = requestsGroup.cached || [];\n\n    const results = [];\n\n    const moduleNames = uniq(uncached.map(({ moduleName }) => moduleName));\n\n    const resourceObject = transform(\n      await resource({ moduleNames, language }),\n      (result, value, index) => {\n        const moduleName = moduleNames[index];\n        result[moduleName] = value;\n      },\n      {}\n    );\n    cached.forEach(request => {\n      const formatValue = cache.get(getCacheKey(request));\n      const index = requests.indexOf(request);\n      results[index] = formatValue;\n    });\n    uncached.forEach(request => {\n      const formatValue = (request => {\n        if (cache.has(getCacheKey(request))) {\n          return cache.get(getCacheKey(request));\n        }\n        const currentResource = resourceObject[request.moduleName];\n        if (!currentResource) {\n          return placeholder;\n        }\n        const enumValue = currentResource.get(String(request.value));\n        if (!enumValue) {\n          return placeholder;\n        }\n        const formatValue = formatEnum({ value: enumValue, format: request.format || format, language });\n        formatValue && cache.set(getCacheKey(request), formatValue);\n        return formatValue;\n      })(request);\n\n      const index = requests.indexOf(request);\n      results[index] = formatValue;\n    });\n\n    return results;\n  });\n};\n\nconst EnumResource = p => {\n  const { moduleName, children, format, ...props } = Object.assign(\n    {},\n    {\n      format: 'origin'\n    },\n    p\n  );\n  const resource = useEnumResource();\n  const { language, locale } = useGlobalContext();\n  return (\n    <Fetch\n      {...props}\n      data={{\n        moduleName\n      }}\n      loader={({ data }) => {\n        const { moduleName } = Object.assign({}, data);\n        return resource({\n          moduleNames: Array.isArray(moduleName) ? moduleName : [moduleName],\n          language: language || locale\n        });\n      }}\n      render={({ data }) => {\n        if (typeof children === 'function') {\n          return children(\n            Array.isArray(moduleName)\n              ? data.map(item =>\n                  Array.from(item.values()).map(value =>\n                    formatEnum({\n                      value,\n                      format,\n                      language,\n                      locale\n                    })\n                  )\n                )\n              : Array.from(data[0].values()).map(value =>\n                  formatEnum({\n                    value,\n                    format,\n                    language,\n                    locale\n                  })\n                )\n          );\n        }\n        return children;\n      }}\n    />\n  );\n};\n\nconst EnumLegacy = p => {\n  const { moduleName, name, format, force, children, placeholder, ...props } = Object.assign(\n    {},\n    {\n      force: false\n    },\n    p\n  );\n  const { language, locale } = useGlobalContext();\n  const loader = useEnumLoader();\n\n  if (isEmpty(name)) {\n    return (\n      <EnumResource moduleName={moduleName} format={format || 'origin'}>\n        {children}\n      </EnumResource>\n    );\n  }\n\n  return (\n    <Fetch\n      {...props}\n      loader={({ data }) => {\n        const { requests, language, format } = Object.assign({}, data);\n        return loader({ requests, language, format, placeholder });\n      }}\n      data={{\n        requests: [\n          {\n            moduleName,\n            value: name,\n            force,\n            format: typeof children === 'function' ? 'origin' : format || 'default'\n          }\n        ],\n        language: language || locale || window.navigator.language\n      }}\n      render={({ data, ...fetchApi }) => {\n        const output = Array.isArray(moduleName) ? data : data[0];\n        if (typeof children === 'function') {\n          return children(output, fetchApi);\n        }\n        return children || output;\n      }}\n    />\n  );\n};\n\nconst Enum = p => {\n  const { request, children, placeholder, ...props } = Object.assign(\n    {},\n    {\n      format: 'default'\n    },\n    p\n  );\n  const { language, locale } = useGlobalContext();\n  const loader = useEnumLoader();\n  return (\n    <Fetch\n      {...props}\n      loader={({ data }) => {\n        const { requests, format, language } = Object.assign({}, data);\n        return loader({ requests, language, format, placeholder });\n      }}\n      data={{\n        requests: Array.isArray(request) ? request : [request],\n        language: language || locale || window.navigator.language\n      }}\n      render={({ data, ...fetchApi }) => {\n        if (typeof children === 'function') {\n          return children(Array.isArray(request) ? data : data[0], fetchApi);\n        }\n        return children || data.join(',');\n      }}\n    />\n  );\n};\n\nexport default EnumLegacy;\n\nexport { preset, Enum, EnumResource, useEnumLoader, useEnumResource };\n"],"names":["globalParams","base","cache","max","LRUCache","preset","options","merge","getCache","formatEnum","_ref3","value","format","language","locale","_value$translation","label","translation","description","Object","assign","useEnumResource","enums","usePreset","useRefCallback","async","moduleNames","_ref4","Promise","all","map","loader","target","console","warn","concat","resource","Array","isArray","Map","item","String","Error","useEnumLoader","requests","placeholder","_ref5","getCacheKey","request","Symbol","for","moduleName","requestsGroup","groupBy","force","has","uncached","cached","results","uniq","_ref6","resourceObject","transform","result","index","forEach","formatValue","get","indexOf","currentResource","enumValue","set","EnumResource","p","_Object$assign","children","props","_objectWithoutPropertiesLoose","_excluded","useGlobalContext","React","Fetch","_extends","data","_ref7","render","_ref8","from","values","EnumLegacy","_Object$assign2","name","_excluded2","isEmpty","_ref9","window","navigator","_ref","fetchApi","_excluded3","output","Enum","_Object$assign3","_excluded4","_ref0","_ref2","_excluded5","join"],"ignoreList":[],"sourceRoot":""}