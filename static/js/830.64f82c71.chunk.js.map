{"version":3,"file":"static/js/830.64f82c71.chunk.js","mappings":"swBAGO,MAAMA,EAAe,CAC1BC,KAAM,CAAC,EACPC,MAAO,CACLC,IAAK,MAIT,IAAID,EAAQ,IAAIE,EAAAA,EAASJ,EAAaE,OAEhC,MAAAG,EAASC,IACbC,IAAMP,EAAcM,GACpBJ,EAAQ,IAAIE,EAAAA,EAASJ,EAAaE,MAAM,EAG7BM,EAAWA,IACfN,E,yICTHO,EAAaC,IAAiC,IAAhC,MAAEC,EAAK,OAAEC,EAAM,SAAEC,GAAUH,EAAK,IAAAI,EAClD,MAAMC,GAAQ,OAAAD,EAAAH,EAAMK,aAAN,EAAAF,EAAeD,KAAaF,EAAMM,YAChD,MAAe,WAAXL,EACKD,EAEM,WAAXC,EACKM,OAAOC,OAAO,CAAC,EAAGR,EAAO,CAAEI,UAE7BA,CAAK,EAGRK,EAAkBA,KACtB,MAAM,MAAEC,IAAUC,EAAAA,EAAAA,aAClB,OAAOC,EAAAA,EAAAA,IAAeC,UAA2B,IAApB,YAAEC,GAAaC,EAkB1C,aAAaC,QAAQC,IAAIH,EAAYI,KAjBjBL,UAClB,MAAMM,EAASZ,OAAOC,OAAO,CAAC,EAAGnB,EAAaC,KAAMoB,GAAOU,GAC3D,IAAKD,EAEH,OADAE,QAAQC,KAAK,gBAAMF,4DACZ,KAGT,MAAMG,QAAoC,oBAAXJ,EAAwBA,EAAO,CAAEC,WAAYD,GAE5E,GAAIK,MAAMC,QAAQF,GAChB,OAAO,IAAIG,IAAIH,EAASL,KAAIS,GAAQ,CAACA,EAAK3B,MAAM4B,WAAYD,MAE9D,GAAIJ,aAAoBG,IACtB,OAAOH,EAET,MAAM,IAAIM,MAAM,uGAAiC,IAEG,GACtD,EAGEC,EAAgBA,KACpB,MAAM,SAAE5B,IAAaS,EAAAA,EAAAA,aACfY,EAAWd,IACjB,OAAOG,EAAAA,EAAAA,IAAeC,UAAgC,IAAzB,SAAEkB,EAAQ,OAAE9B,GAAQ+B,EAC/C,MAAMzC,EAAQM,IACRoC,EAAcC,GACXC,OAAOC,IAAI,GAAGF,EAAQG,cAAcH,EAAQlC,SAASkC,EAAQjC,QAAUA,MAE1E,OAAEqC,EAAM,SAAEC,GAAaC,IAAQT,GAAUG,IACrCA,EAAQO,OAASlD,EAAMmD,IAAIT,EAAYC,IAAY,SAAW,aAGlES,EAAU,GAEV7B,EAAc8B,IAAKL,EAASrB,KAAI2B,IAAA,IAAC,WAAER,GAAYQ,EAAA,OAAKR,CAAU,KAE9DS,EAAiBC,UACfxB,EAAS,CAAET,iBACjB,CAACkC,EAAQhD,EAAOiD,KAEdD,EADmBlC,EAAYmC,IACVjD,CAAK,GAE5B,CAAC,GAyBH,OAtBCsC,GAAU,IAAIY,SAAQhB,IACrB,MAAMiB,EAAc5D,EAAM6D,IAAInB,EAAYC,IACpCe,EAAQlB,EAASsB,QAAQnB,GAC/BS,EAAQM,GAASE,CAAW,KAG7BZ,GAAY,IAAIW,SAAQhB,IACvB,MAAMiB,EAAc,CAACjB,IACnB,GAAI3C,EAAMmD,IAAIT,EAAYC,IACxB,OAAO3C,EAAM6D,IAAInB,EAAYC,IAE/B,MACMoB,EADkBR,EAAeZ,EAAQG,YACbe,IAAIlB,EAAQlC,OACxCmD,EAAcrD,EAAW,CAAEE,MAAOsD,EAAWrD,OAAQiC,EAAQjC,QAAUA,EAAQC,aAErF,OADAX,EAAMgE,IAAItB,EAAYC,GAAUiB,GACzBA,CACR,EATmB,CASjBjB,GAEGe,EAAQlB,EAASsB,QAAQnB,GAC/BS,EAAQM,GAASE,CAAW,IAGvBR,CAAO,GACd,EAGEa,EAAUA,KACd,MAAMrC,EAASW,IACf,OAAO2B,EAAAA,EAAAA,UAAS,CACdtC,OAAQuC,IAAc,IAAb,KAAEC,GAAMD,EACf,MAAM,SAAE3B,EAAQ,OAAE9B,GAAWM,OAAOC,OAAO,CAAC,EAAG,CAAEP,OAAQ,WAAa0D,GACtE,OAAOxC,EAAO,CAAEY,WAAU9B,UAAS,GAErC,EAGE2D,EAAeC,IACnB,MAAAC,EAAmDvD,OAAOC,OACxD,CAAC,EACD,CACEP,OAAQ,UAEV4D,IALI,WAAExB,EAAU,SAAE0B,EAAQ,OAAE9D,GAAkB6D,EAAPE,EAAKC,EAAAH,EAAAI,GAOxC3C,EAAWd,KACX,SAAEP,IAAaS,EAAAA,EAAAA,aACrB,OACEwD,IAAAA,cAACC,IAAKC,EAAA,GACAL,EAAK,CACTL,KAAM,CACJtB,cAEFlB,OAAQmD,IAAc,IAAb,KAAEX,GAAMW,EACf,MAAM,WAAEjC,GAAe9B,OAAOC,OAAO,CAAC,EAAGmD,GACzC,OAAOpC,EAAS,CAAET,YAAaU,MAAMC,QAAQY,GAAcA,EAAa,CAACA,IAAc,EAEzFkC,OAAQC,IAAc,IAAb,KAAEb,GAAMa,EACf,MAAwB,oBAAbT,EACFA,EACLvC,MAAMC,QAAQY,GACVsB,EAAKzC,KAAIS,GACPH,MAAMiD,KAAK9C,EAAK+C,UAAUxD,KAAIlB,GAC5BF,EAAW,CACTE,QACAC,SACAC,iBAINsB,MAAMiD,KAAKd,EAAK,GAAGe,UAAUxD,KAAIlB,GAC/BF,EAAW,CACTE,QACAC,SACAC,gBAKL6D,CAAQ,IAEjB,EAIAY,EAAad,IACjB,MAAAe,EAAgErE,OAAOC,OACrE,CAAC,EACD,CACEiC,OAAO,GAEToB,IALI,WAAExB,EAAU,KAAEwC,EAAI,OAAE5E,EAAM,MAAEwC,EAAK,SAAEsB,GAAoBa,EAAPZ,EAAKC,EAAAW,EAAAE,GAOrD3D,EAASW,IAEf,OAAK+C,EASHV,IAAAA,cAACC,IAAKC,EAAA,GACAL,EAAK,CACT7C,OAAQ4D,IAAc,IAAb,KAAEpB,GAAMoB,EACf,MAAM,SAAEhD,EAAQ,OAAE9B,GAAWM,OAAOC,OAAO,CAAC,EAAGmD,GAC/C,OAAOxC,EAAO,CAAEY,WAAU9B,UAAS,EAErC0D,KAAM,CACJ5B,SAAU,CACR,CACEM,aACArC,MAAO6E,EACPpC,QACAxC,OAA4B,oBAAb8D,EAA0B,SAAW9D,GAAU,aAIpEsE,OAAQS,IAA2B,IAA1B,KAAErB,GAAmBqB,EAAVC,EAAQhB,EAAAe,EAAAE,GAC1B,MAAwB,oBAAbnB,EACFA,EAASJ,EAAMsB,GAEjBlB,GAAYJ,CAAI,KA3BzBQ,IAAAA,cAACP,EAAY,CAACvB,WAAYA,EAAYpC,OAAQA,GAAU,UACrD8D,EA4BH,EAIAoB,EAAOtB,IACX,MAAAuB,EAAyC7E,OAAOC,OAC9C,CAAC,EACD,CACEP,OAAQ,WAEV4D,IALI,SAAE9B,EAAQ,SAAEgC,GAAoBqB,EAAPpB,EAAKC,EAAAmB,EAAAC,GAO9BlE,EAASW,IACf,OACEqC,IAAAA,cAACC,IAAKC,EAAA,GACAL,EAAK,CACT7C,OAAQmE,IAAc,IAAb,KAAE3B,GAAM2B,EACf,MAAM,SAAEvD,EAAQ,OAAE9B,GAAWM,OAAOC,OAAO,CAAC,EAAGmD,GAC/C,OAAOxC,EAAO,CAAEY,WAAU9B,UAAS,EAErC0D,KAAM,CAAE5B,YACRwC,OAAQgB,IAA2B,IAA1B,KAAE5B,GAAmB4B,EAAVN,EAAQhB,EAAAsB,EAAAC,GAC1B,MAAwB,oBAAbzB,EACFA,EAASJ,EAAMsB,GAEjBlB,GAAYJ,EAAK8B,KAAK,IAAI,IAEnC,C","sources":["../../src/preset.js","../../src/index.js"],"sourcesContent":["import { LRUCache } from 'lru-cache';\nimport merge from 'lodash';\n\nexport const globalParams = {\n  base: {},\n  cache: {\n    max: 100\n  }\n};\n\nlet cache = new LRUCache(globalParams.cache);\n\nconst preset = options => {\n  merge(globalParams, options);\n  cache = new LRUCache(globalParams.cache);\n};\n\nexport const getCache = () => {\n  return cache;\n};\n\nexport default preset;\n","import React from 'react';\nimport { usePreset } from '@kne/global-context';\nimport useRefCallback from '@kne/use-ref-callback';\nimport Fetch, { useFetch } from '@kne/react-fetch';\nimport groupBy from 'lodash/groupBy';\nimport uniq from 'lodash/uniq';\nimport transform from 'lodash/transform';\nimport preset, { globalParams, getCache } from './preset';\n\nconst formatEnum = ({ value, format, language }) => {\n  const label = value.locale?.[language] || value.description;\n  if (format === 'origin') {\n    return value;\n  }\n  if (format === 'option') {\n    return Object.assign({}, value, { label });\n  }\n  return label;\n};\n\nconst useEnumResource = () => {\n  const { enums } = usePreset();\n  return useRefCallback(async ({ moduleNames }) => {\n    const getResource = async target => {\n      const loader = Object.assign({}, globalParams.base, enums)[target];\n      if (!loader) {\n        console.warn(`枚举[${target}]的loader没有被正确设置`);\n        return null;\n      }\n\n      const resource = await (typeof loader === 'function' ? loader({ target }) : loader);\n\n      if (Array.isArray(resource)) {\n        return new Map(resource.map(item => [item.value.toString(), item]));\n      }\n      if (resource instanceof Map) {\n        return resource;\n      }\n      throw new Error('获取到的resource类型不正确，仅支持Array或Map');\n    };\n    return await Promise.all(moduleNames.map(getResource));\n  });\n};\n\nconst useEnumLoader = () => {\n  const { language } = usePreset();\n  const resource = useEnumResource();\n  return useRefCallback(async ({ requests, format }) => {\n    const cache = getCache();\n    const getCacheKey = request => {\n      return Symbol.for(`${request.moduleName}_${request.value}_${request.format || format}`);\n    };\n    const { cached, uncached } = groupBy(requests, request => {\n      return !request.force && cache.has(getCacheKey(request)) ? 'cached' : 'uncached';\n    });\n\n    const results = [];\n\n    const moduleNames = uniq(uncached.map(({ moduleName }) => moduleName));\n\n    const resourceObject = transform(\n      await resource({ moduleNames }),\n      (result, value, index) => {\n        const moduleName = moduleNames[index];\n        result[moduleName] = value;\n      },\n      {}\n    );\n\n    (cached || []).forEach(request => {\n      const formatValue = cache.get(getCacheKey(request));\n      const index = requests.indexOf(request);\n      results[index] = formatValue;\n    });\n\n    (uncached || []).forEach(request => {\n      const formatValue = (request => {\n        if (cache.has(getCacheKey(request))) {\n          return cache.get(getCacheKey(request));\n        }\n        const currentResource = resourceObject[request.moduleName];\n        const enumValue = currentResource.get(request.value);\n        const formatValue = formatEnum({ value: enumValue, format: request.format || format, language });\n        cache.set(getCacheKey(request), formatValue);\n        return formatValue;\n      })(request);\n\n      const index = requests.indexOf(request);\n      results[index] = formatValue;\n    });\n\n    return results;\n  });\n};\n\nconst useEnum = () => {\n  const loader = useEnumLoader();\n  return useFetch({\n    loader: ({ data }) => {\n      const { requests, format } = Object.assign({}, { format: 'default' }, data);\n      return loader({ requests, format });\n    }\n  });\n};\n\nconst EnumResource = p => {\n  const { moduleName, children, format, ...props } = Object.assign(\n    {},\n    {\n      format: 'origin'\n    },\n    p\n  );\n  const resource = useEnumResource();\n  const { language } = usePreset();\n  return (\n    <Fetch\n      {...props}\n      data={{\n        moduleName\n      }}\n      loader={({ data }) => {\n        const { moduleName } = Object.assign({}, data);\n        return resource({ moduleNames: Array.isArray(moduleName) ? moduleName : [moduleName] });\n      }}\n      render={({ data }) => {\n        if (typeof children === 'function') {\n          return children(\n            Array.isArray(moduleName)\n              ? data.map(item =>\n                  Array.from(item.values()).map(value =>\n                    formatEnum({\n                      value,\n                      format,\n                      language\n                    })\n                  )\n                )\n              : Array.from(data[0].values()).map(value =>\n                  formatEnum({\n                    value,\n                    format,\n                    language\n                  })\n                )\n          );\n        }\n        return children;\n      }}\n    />\n  );\n};\n\nconst EnumLegacy = p => {\n  const { moduleName, name, format, force, children, ...props } = Object.assign(\n    {},\n    {\n      force: false\n    },\n    p\n  );\n  const loader = useEnumLoader();\n\n  if (!name) {\n    return (\n      <EnumResource moduleName={moduleName} format={format || 'origin'}>\n        {children}\n      </EnumResource>\n    );\n  }\n\n  return (\n    <Fetch\n      {...props}\n      loader={({ data }) => {\n        const { requests, format } = Object.assign({}, data);\n        return loader({ requests, format });\n      }}\n      data={{\n        requests: [\n          {\n            moduleName,\n            value: name,\n            force,\n            format: typeof children === 'function' ? 'origin' : format || 'default'\n          }\n        ]\n      }}\n      render={({ data, ...fetchApi }) => {\n        if (typeof children === 'function') {\n          return children(data, fetchApi);\n        }\n        return children || data;\n      }}\n    />\n  );\n};\n\nconst Enum = p => {\n  const { requests, children, ...props } = Object.assign(\n    {},\n    {\n      format: 'default'\n    },\n    p\n  );\n  const loader = useEnumLoader();\n  return (\n    <Fetch\n      {...props}\n      loader={({ data }) => {\n        const { requests, format } = Object.assign({}, data);\n        return loader({ requests, format });\n      }}\n      data={{ requests }}\n      render={({ data, ...fetchApi }) => {\n        if (typeof children === 'function') {\n          return children(data, fetchApi);\n        }\n        return children || data.join(',');\n      }}\n    />\n  );\n};\n\nexport default EnumLegacy;\n\nexport { preset, Enum, EnumResource, useEnum, useEnumLoader, useEnumResource };\n"],"names":["globalParams","base","cache","max","LRUCache","preset","options","merge","getCache","formatEnum","_ref3","value","format","language","_value$locale","label","locale","description","Object","assign","useEnumResource","enums","usePreset","useRefCallback","async","moduleNames","_ref4","Promise","all","map","loader","target","console","warn","resource","Array","isArray","Map","item","toString","Error","useEnumLoader","requests","_ref5","getCacheKey","request","Symbol","for","moduleName","cached","uncached","groupBy","force","has","results","uniq","_ref6","resourceObject","transform","result","index","forEach","formatValue","get","indexOf","enumValue","set","useEnum","useFetch","_ref7","data","EnumResource","p","_Object$assign","children","props","_objectWithoutPropertiesLoose","_excluded","React","Fetch","_extends","_ref8","render","_ref9","from","values","EnumLegacy","_Object$assign2","name","_excluded2","_ref10","_ref","fetchApi","_excluded3","Enum","_Object$assign3","_excluded4","_ref11","_ref2","_excluded5","join"],"sourceRoot":""}